{{ define "main" }}
  {{- partial "navbar_temp.html" . -}}
  <script src="https://code.iconify.design/iconify-icon/1.0.0/iconify-icon.min.js"></script>
  <script type="text/javascript">
    function generateGCalLink(){
      let gCalUrl = new URL("https://www.google.com/calendar/render?");
      let details = new URLSearchParams(gCalUrl.search)

      const monthDict = {
        "Jan" : "01",
        "Feb" : "02",
        "Mar" : "03",
        "Apr" : "04",
        "May" : "05",
        "Jun" : "06",
        "Jul" : "07",
        "Aug" : "08",
        "Sep" : "09",
        "Oct" : "10",
        "Nov" : "11",
        "Dec" : "12"
      }

      const dateString = {{ .Params.date.Format "2006" }} + monthDict[{{ .Params.date.Format "Jan" }}] + {{ .Params.date.Format "2" }}
      let startTimeHour = parseInt({{ .Params.start_time }}.split(" ")[0].split(":")[0])
      let endTimeHour = parseInt({{ .Params.start_time }}.split(" ")[2].split(":")[0])

      // event begins in the morning and ends in the afternoon/evening
      // only convert endtime to 24 hour time
      // e.g 11:00 AM - 3:00 PM
      if (startTimeHour > endTimeHour){
        endTimeHour += 12
      
      // event starts and ends in the afternoon/evening OR starts in the morning and ends at 12PM
      // convert both times to 24 hour time
      // e.g 1:00 - 3:00 PM
      // e.g 11:00 - 12:00 PM
      }else if ( {{ .Params.start_time}}.includes("PM") && endTimeHour < 12){
        startTimeHour += 12
        endTimeHour += 12
      }

      // startTimeHour = (startTimeHour + 4) % 24
      // endTimeHour = (endTimeHour + 4) % 24

      // if an event starts and ends in the AM then they are already in 24 hour time
      // e.g 10:00 - 11:00 AM

      const startTime = startTimeHour.toString() + {{ .Params.start_time }}.split(" ")[0].split(":")[1] + "00"
      const endTime = endTimeHour.toString() + {{ .Params.start_time }}.split(" ")[2].split(":")[1] + "00"

      details.append("action", "TEMPLATE");
      details.append("text", {{ .Params.title }});
      details.append("details", {{ .Params.short_description }});
      details.append("location", {{ .Params.location }});
      details.append("dates", dateString + "T" + startTime + "E/" + dateString + "T" + endTime + "E");
      return gCalUrl + details;
    }

    window.onload = function(){
      gCalButton = document.getElementById("g-cal-button")
      gCalButton.href = generateGCalLink()
    }
     
  </script>
  <div class="event-page">
    <!--Background-->
    {{- if ne .Params.hideBanner true }}
      <section
        class="event_header"
        style="background-image:url({{ absURL .Params.background }});"
      ></section>
      <section
        class="event_header event_blur"
        style="background-image:url({{ absURL .Params.background }});"
      ></section>
    {{- end }}

    <!-- Date card -->

    <!--Content-->
    <div class="{{ if .Params.full }}wrap post{{ else }}event{{ end }}">
      <div class="date_card_about">
        <h3 style="text-align: center;">
          {{ .Params.date.Format "Jan" | upper }}
        </h3>
        <h2 style="text-align: center;">{{ .Params.date.Format "2" }}</h2>
        <h3 style="text-align: center;">{{ .Params.date.Format "2006" }}</h3>
      </div>
      <div class="event_container">
        <div
          class="event_container_poster"
          style="background-image:url({{ absURL .Params.poster }}); background-size: {{ .Params.poster_cover }}; background-position: {{ .Params.poster_position }}"
        ></div>
        <div class="event_container_content">
          <div>
            <h2>{{ .Params.title }}</h2>
            <p>{{ .Params.short_description }}</p>
          </div>
          <div>
            <div class="event-subtitle">START TIME</div>
            <div class="event-time">{{ .Params.start_time }}</div>
          </div>
          <div>
            <div class="event-subtitle">LOCATION</div>
            <a href="{{ .Params.location_link }}"
              >{{- partial "button.html" (dict "label" .Params.location) -}}</a
            >
          </div>
          <div>
            <div class="event-subtitle">ADD TO CALENDAR</div>
            <div class="calendar-icons">
              <a id="g-cal-button" target="_blank"><iconify-icon  class="hvr-float" icon="akar-icons:google-fill" style="color: #c40729;" width="30"></iconify-icon></a>
              <a id="apple-button" target="_blank"><iconify-icon id="apple-button" class="hvr-float" icon="ant-design:apple-filled" style="color: #c40729;" width="30"></iconify-icon></a>
              <a id="outlook-button" target="_blank"><iconify-icon id="outlook-button" class="hvr-float" icon="file-icons:microsoft-outlook" style="color: #c40729;" width="30"></iconify-icon></a>
              <a id="yahoo-button" target="_blank"><iconify-icon id="yahoo-button" class="hvr-float" icon="mdi:yahoo" style="color: #c40729;" width="30"></iconify-icon></a>
            </div>
          </div>
        </div>
      </div>
      {{ if ne (len .Content) 0 }}
        <hr />
        <div class="markdown-content">
          {{ .Content }}
        </div>
      {{ end }}
    </div>
  </div>
{{ end }}
